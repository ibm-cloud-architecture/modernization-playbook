(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{URHZ:function(e,t,a){"use strict";a.r(t),a.d(t,"Title",(function(){return c})),a.d(t,"_frontmatter",(function(){return s})),a.d(t,"default",(function(){return m}));var n=a("wx14"),i=a("zLVn"),o=(a("q1tI"),a("7ljp")),r=a("013z"),c=(a("qKvR"),function(){return Object(o.b)("span",null,"Refactoring Java EE Applications",Object(o.b)("br",null)," ",Object(o.b)("h2",null,"Using the strangler pattern"))}),s={},p=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(o.b)("div",t)}},d=p("PageDescription"),l=p("AnchorLinks"),b=p("AnchorLink"),g={Title:c,_frontmatter:s},u=r.a;function m(e){var t=e.components,a=Object(i.a)(e,["components"]);return Object(o.b)(u,Object(n.a)({},g,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)(d,{mdxType:"PageDescription"},Object(o.b)("p",null,"Using the strangler pattern")),Object(o.b)(l,{small:!0,mdxType:"AnchorLinks"},Object(o.b)(b,{mdxType:"AnchorLink"},"Introduction"),Object(o.b)(b,{mdxType:"AnchorLink"},"Refactor the Catalog service to Quarkus"),Object(o.b)(b,{mdxType:"AnchorLink"},"Analyze the Mono2Micro results"),Object(o.b)(b,{mdxType:"AnchorLink"},"The Quarkus Event Producer"),Object(o.b)(b,{mdxType:"AnchorLink"},"The Event Consumer"),Object(o.b)(b,{mdxType:"AnchorLink"},"Run this solution"),Object(o.b)(b,{mdxType:"AnchorLink"},"Summary")),Object(o.b)("h2",null,"Introduction"),Object(o.b)("p",null,"In this phase the backend application was analyzed and the Catalog service was identified as a candidate to be extracted in to it’s own Micro Service. The code was strangled from the monolith and deployed using Quarkus allowing the service to be developed, deployed and scaled independently of the rest of the application code."),Object(o.b)("h3",null,"Refactor the Catalog service to Quarkus"),Object(o.b)("p",null,"The ",Object(o.b)("a",{parentName:"p",href:"http://ibm.biz/Mono2Micro"},"Mono2Micro")," tool was used to identify the ",Object(o.b)("inlineCode",{parentName:"p"},"Catalog")," service as a good candidate to become it’s own service. In this scenario, the ",Object(o.b)("inlineCode",{parentName:"p"},"Catalog")," service handles information about the items in the store such as prices, titles, ratings and descriptions. When this information changes the store front as well as the items in the users carts should be updated."),Object(o.b)("p",null,"  ",Object(o.b)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(o.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"41.66666666666667%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABY0lEQVQoz4WSSy9DQRTHu7YT8RVsxMp38Q0spNYSNj6FHaFCSwXxWFiwQKIlQpsgHi2it6je0vtoy9yZ+zP3VkXiNckvc86cOf+cc2YiCpA3t4iJaURsFjE1G+7e4goinkRMzuBNxxHjMbz1DZTvo5T6hud5IZFAEMOAuQQsLGiSkJyHtTVYXmrawXkiDlub/LaklB+C0sP14K6mdetQ1BS0fd9o+oFt6vitC4/a/6m6AF9XHohG9BVWj3za+iWdg4qeEUXvqKJ7WNERVbQPKKIxRdeQpG8s7EcnN/m6hBAhEXyJ6cBeXpODzB2cFOHwBlIfZ7mST7YAV6VA6J8KA+fttYZdMXCei7yUDeq2qYdSo1ou0LCfEA2bUvGaauXhM7kp5H+xVatlPaNKhVR6n6PjDOn0AecXlzyVTbZ3djk9O+elaulYllz++scHaVUXCvq/fIMWrutiWRaO44QESX89zDvCW1O4gIT6wwAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(o.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"Step 6",title:"Step 6",src:"/modernization-playbook/static/9a99a03daad9bb7c77020ede59477836/3cbba/step6.png",srcSet:["/modernization-playbook/static/9a99a03daad9bb7c77020ede59477836/7fc1e/step6.png 288w","/modernization-playbook/static/9a99a03daad9bb7c77020ede59477836/a5df1/step6.png 576w","/modernization-playbook/static/9a99a03daad9bb7c77020ede59477836/3cbba/step6.png 1152w","/modernization-playbook/static/9a99a03daad9bb7c77020ede59477836/9930d/step6.png 1184w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(o.b)("h3",null,"Analyze the Mono2Micro results"),Object(o.b)("p",null,"Running Mono2Micro is out of the scope of this article but detailed steps can be found ",Object(o.b)("a",{parentName:"p",href:"http://heidloff.net/article/step-by-step-instructions-mono2micro/"},"here"),"."),Object(o.b)("p",null,"  ",Object(o.b)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(o.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"50.34722222222222%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABzUlEQVQozzVSV5aDMAzMKdIr7sZgMDXlJbv3P9SsLDYfejbCmhmNtDLGoKoqnM9nHA8HHI9HjtPpyLnT6cTfl8sFt9uN79frFReKfN9RzX6/x2az4TerEAJyKK05dD6VQkm5lDoMw4CuW87744GmbZf7PKNLCdpaBBKUiQ8EvtJU7JSB1QalsXxqpWH7F1zdEmjigqqu0fU95s8HXdMgxBrDOMI5SyIUttstx8pbh09HbHWDOXYYQwNrPcr5A0+5hooFqSgzKAFq76FKDxlKRFKb3yrtuG1W6OjxT/9ArGrEUOGdJhhqO5KimqJtG1IsERK1+noiTiPqGGGpm5bIrAsw7n8G5CkBOvwOC+AQE17dRI8NhBTsZ9v0aOOAaXqTby887280BJhBE5EIskuaAFEI9pFb/u3vKJ3HqyV2H9hHRb4YbVFcBTypaMqZchKysFBSQUrJIYRgdbvdbvGw8iXubY/7MOI9PpAJHAHlSWsC9qZGqieapoAUmgA155dtWLYir9F6vV4A85R5TcqSJubYv+/qZIVa0UBsjeAjgktM8P2/kGoURcF7yIDfZJb/fZSZc8tZiRIWlU/UwQ9562BVWPL/dXnZc8vftfkD4DsmVNa2aLIAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(o.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"m2m",title:"m2m",src:"/modernization-playbook/static/bc8b9fa7e6c26c6fd40fa0581e9d5699/3cbba/mono2mircro-3-partitions-1.png",srcSet:["/modernization-playbook/static/bc8b9fa7e6c26c6fd40fa0581e9d5699/7fc1e/mono2mircro-3-partitions-1.png 288w","/modernization-playbook/static/bc8b9fa7e6c26c6fd40fa0581e9d5699/a5df1/mono2mircro-3-partitions-1.png 576w","/modernization-playbook/static/bc8b9fa7e6c26c6fd40fa0581e9d5699/3cbba/mono2mircro-3-partitions-1.png 1152w","/modernization-playbook/static/bc8b9fa7e6c26c6fd40fa0581e9d5699/0b124/mono2mircro-3-partitions-1.png 1728w","/modernization-playbook/static/bc8b9fa7e6c26c6fd40fa0581e9d5699/4ea69/mono2mircro-3-partitions-1.png 2304w","/modernization-playbook/static/bc8b9fa7e6c26c6fd40fa0581e9d5699/a9544/mono2mircro-3-partitions-1.png 3528w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(o.b)("p",null,"The purple rectangle is essentially the catalog service (except of the missing Category class)."),Object(o.b)("p",null,"The green classes make up the remaining monolith (except of Address)."),Object(o.b)("p",null,"The red classes need to be assigned to either the catalog service of the remaining monolith dependent of class dependencies. Most of them are exceptions which weren’t covered in the use cases."),Object(o.b)("h3",null,"The Quarkus Event Producer"),Object(o.b)("p",null,"In order to display the new price, the order service (the remaining monolith) could invoke a synchronous REST API of the catalog service. However, in order to minimize the coupling between the components, we will use events instead."),Object(o.b)("p",null,"Here is the ",Object(o.b)("a",{parentName:"p",href:"https://github.com/nheidloff/application-modernization-javaee-quarkus/blob/master/service-catalog-quarkus-synch/src/main/java/com/ibm/catalog/ProductResource.java"},"code")," of the ‘strangled’ catalog service which has been implemented with Quarkus. The application uses MicroProfile and Kafka to send events asynchronously."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'@PUT\n@Consumes("application/json")\n@Produces("application/json")\n@Path("/CustomerOrderServicesWeb/jaxrs/Product/{id}")\n@Transactional\npublic Product update(@PathParam("id") Long id, Product updatedProduct) {\n   Product existingProduct = entityManager.find(Product.class, id);\n   if (existingProduct == null) {\n      throw new WebApplicationException(Response.Status.BAD_REQUEST);\n   }\n   existingProduct.price = updatedProduct.price;\n   entityManager.persist(existingProduct);\n   sendMessageToKafka(existingProduct.id, existingProduct.price);\n   return existingProduct;\n}\n\n@ConfigProperty(name = "kafka.bootstrap.servers")\nString kafkaBootstrapServer;\n\n@Inject\nVertx vertx;\n\nprivate KafkaProducer<String, String> producer;\n\n@PostConstruct\nvoid initKafkaClient() {\n   Map<String, String> config = new HashMap<>();\n   config.put("bootstrap.servers", kafkaBootstrapServer);\n   config.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");\n   config.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");\n   producer = KafkaProducer.create(vertx, config);\n}\n\npublic void sendMessageToKafka(Long productId, BigDecimal price) {\n   String productIdString = productId.toString();\n   String priceString = price.toString();\n   try {\n      KafkaProducerRecord<String, String> record = KafkaProducerRecord.create("product-price-updated", productIdString + "#" + priceString);\n      producer.write(record, done -> System.out.println("Kafka message sent: product-price-updated - " + productIdString + "#" + priceString));\n   } catch (Exception e) {\n   }\n}\n')),Object(o.b)("h3",null,"The Event Consumer"),Object(o.b)("p",null,"The remaining monolith runs on Open Liberty. In order to prevent synchronous invocations of the catalog service, it caches the changed prices in it’s own Db2 database in a new column."),Object(o.b)("p",null,"  ",Object(o.b)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(o.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"37.84722222222222%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABb0lEQVQoz42Ry27bMBBF9f+f0X5Bd+k+aBdFUtRxkYcUy9ZbokSJelGSZZ+OHWRToGgucMHB8M7lzNBJs5BSadJCY5qWqe/p5BxMR10osiQlDAOiIKKuNGM30LcdU9exjJajnYQWKzmjKxwlRaXWRJWhqhvsPOOlJbuDT1lVDFJUm4Yzb2jtSNuULLZnnI/YccDaATOIrtY4RVFQi6EqctpWOhSRn2RsDwEbN+I5KPC8HYcwIkhyXn0fX7o9yP0+SvH2IduXHbswppCGnLu7H8Rxgp0m1vXEcVl48vY8uAmPgcaLNJmqibKKKJdYVpOqhjivxDi5ruqaE+ZKRg7SDPflid5UsM7oShFECa2M+Yb3Yf+Pph9xbl3Dze0v7p8zXvOF324gu6jRwgvW04nTB8j5jDIDzudvik9fH7nZ9Hz5OfL9IWTou6vpBRfxWcQfoZ1mnLBs2G7uGZpCyieKLMaYFi0f9bfhe/yvR9Z15Q9cp2FQ9X0PLwAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(o.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"db2",title:"db2",src:"/modernization-playbook/static/e056d1ac19c39938e13b0b49c7b91fc1/3cbba/strangler-caching.png",srcSet:["/modernization-playbook/static/e056d1ac19c39938e13b0b49c7b91fc1/7fc1e/strangler-caching.png 288w","/modernization-playbook/static/e056d1ac19c39938e13b0b49c7b91fc1/a5df1/strangler-caching.png 576w","/modernization-playbook/static/e056d1ac19c39938e13b0b49c7b91fc1/3cbba/strangler-caching.png 1152w","/modernization-playbook/static/e056d1ac19c39938e13b0b49c7b91fc1/0b124/strangler-caching.png 1728w","/modernization-playbook/static/e056d1ac19c39938e13b0b49c7b91fc1/aeb1a/strangler-caching.png 2180w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(o.b)("p",null,"Here is the ",Object(o.b)("a",{parentName:"p",href:"https://github.com/nheidloff/application-modernization-javaee-quarkus/blob/master/monolith-open-liberty-cloud-native/src/main/java/org/pwte/example/ProductPriceChanged.java"},"code")," of the remaining monolith which also uses MicroProfile."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'import org.eclipse.microprofile.reactive.messaging.Incoming;\nimport javax.enterprise.context.ApplicationScoped;\nimport org.pwte.example.service.CustomerOrderServicesImpl;\nimport javax.inject.Inject;\n\n@ApplicationScoped\npublic class ProductPriceChanged {\n\n@Inject\nCustomerOrderServicesImpl customerOrderServices;\n\n@Incoming("product-price-updated")\npublic String process(String message) {\n   String productId = "";\n   String newPrice = "0";\n   try {\n      productId = message.substring(0, message.indexOf("#"));\n      newPrice = message.substring(message.indexOf("#") + 1, message.length());\n      customerOrderServices.updateLineItem(productId, newPrice);\n   }\n   catch (Exception e) {}\n      return message;\n   }\n}\n')),Object(o.b)("h3",null,"Run this solution"),Object(o.b)("p",null,"Use the following steps to run this solution locally on Docker"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"$ git clone https://github.com/IBM/application-modernization-javaee-quarkus.git && cd application-modernization-javaee-quarkus\n$ ROOT_FOLDER=$(pwd)\n$ sh ${ROOT_FOLDER}/scripts-docker/build-and-run-monolith-db2.sh\n$ sh ${ROOT_FOLDER}/scripts-docker/run-database-postgres-catalog.sh\n$ sh ${ROOT_FOLDER}/scripts-docker/run-kafka.sh\n$ sh ${ROOT_FOLDER}/scripts-docker/build-and-run-catalog.sh\n")),Object(o.b)("h2",null,"Summary"),Object(o.b)("p",null,"This application has been refactored in a series of steps from the original ",Object(o.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/cloudpak-for-applications/tree/was855"},"WebSphere ND v8.5.5 version")," to run as Micro Services on Red Hat OpenShift."))}m.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-applications-refactor-catalog-mdx-ea952d80285bd47702de.js.map