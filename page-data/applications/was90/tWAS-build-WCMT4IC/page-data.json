{"componentChunkName":"component---src-pages-applications-was-90-t-was-build-wcmt-4-ic-mdx","path":"/applications/was90/tWAS-build-WCMT4IC/","result":{"pageContext":{"frontmatter":{},"relativePagePath":"/applications/was90/tWAS-build-WCMT4IC.mdx","titleType":"append","MdxNode":{"id":"668c7613-e884-5e69-9b8f-b353516c050a","children":[],"parent":"e4a5dd1b-85ed-524a-9111-29a07c33d273","internal":{"content":"# Building a tWAS container from an existing environment (without scripts)\n\nThis section covers how to containerize an existing application running on traditional WebSphere Application Server.  Ideally a user would have scripts to configure their environment and building a container using scripts is descibed [here](tWAS-build.md). However if you don't have scripts and building those scripts is a daunting task, you can migrate your existing configuration using the [WebSphere Configuration Migration Tool for IBM Cloud (WCMT4IC)](https://developer.ibm.com/wasdev/docs/websphere-config-migration-cloud/).  This tool extracts the configuration from your existing traditional WebSphere Application Server environment and puts it into a tWAS container. \n\n\n## Summary: \nThis section has the following steps:\n\n- Run [WebSphere Configuration Migration Tool for IBM Cloud (WCMT4IC)] to extract the server configuration information from an existing environment.\n- [Using environment variables in properties files to allow configuration to be injected in to the runtime environment dynamically.](tWAS-build.md#modifying-configuration-without-rebuilding-container)\n- Running the application in a Docker container locally\n\n\n## Introduction to the WebSphere Configuration Migration Tool for IBM Cloud\nWCMT4IC is a Java based tool, that provides an easy to use wizard for cloning your WebSphere V7, V8, V855 or V9 environment to the IBM Cloud or to your IBM Cloud Private installation. It allows you to selectively migrate an application deployed in your WebSphere cell into its own WebSphere standalone server, which can run on a virtual machine or in a Docker container ready to be deployed in IBM Cloud Private (ICP).\n\nThis article focuses on the steps required to migrate to a Docker container.\n\n## Install WebSphere Configuration Migration Tool for IBM Cloud\nWCMT4IC is freely available to download from [here](https://developer.ibm.com/wasdev/downloads/#asset/tools-WebSphere_Configuration_Migration_Tool_for_IBM_Cloud). To install the tool extract downloaded file to new directory. As the tool requires Java 8 or higher, make sure Java is available in your PATH environment variable. If not, you can set it like this:\n\nFor Windows:\n\n```set PATH=C:\\java\\bin;%PATH%```\n\nwhere ```C:\\java``` points to you existing Java installation directory\n\n\nFor Linux/Mac:\n\n```export PATH=/opt/java8/bin:$PATH```\n\nwhere ```/opt/java8/``` points to you existing Java installation directory\n\nTo start the tool run this command for the installation folder:\n\n```java -jar CloudMigration.jar```\n\nThe tool can either be installed and run on the machine where WebSphere Application Server is installed or on a remote location. \n\n## Using the tool to generate artifacts\nAfter you start the tool, it opens the following window where you can choose either Virtual Machine wizard or Container (Docker) wizard. In this guide you will use the container one.\n\n1. Click **Start Containers Migration Wizard**\n\n![Wizard](images/tWAS-build/01-wizard.jpg)\n\n2. The welcome screen is shown, which describes overview of the steps. Click **Next >**\n\n![Welcome](images/tWAS-build/02-welcome.jpg)\n\n3. WebSphere cell selection screen is shown. If you are running the tool on the same machine where WebSphere is installed, then the installation folder and list of available cells(profiles) are automatically populated. Select cell and click **Next >**. Alternatively, if installation folder is not populated or WebSphere is not installed locally, click **Locate ...** button to work with remote installation. **If you are running locally, go directly to step 5**.\n\n![Select Cell](images/tWAS-build/03-select-cell.jpg)\n\n4a. (Optional - Remote installation only) Select **Install from an installation on another server** and then click **Save WASPreUpgrade utility**.\n\n![Remote Cell](images/tWAS-build/04-remote-cell.jpg)\n\n4b. Select directory, specify filename for WASPreUpgrade utility archive and click **Save**\n\n![Remote Cell utility](images/tWAS-build/04a-remote-utility.jpg)\n\n4c. Utility is being saved\n\n![Remote Cell progress](images/tWAS-build/04b-remote-utility-progress.jpg)\n\n4d. Transfer the generated utility archive to the target server and unzip it. Utility requires ```JAVA_HOME``` environment variable. You can set it like this.\nFor Windows:\n\n```set JAVA_HOME=C:\\WebSphere\\AppServer\\java```\n\nwhere ```C:\\WebSphere\\AppServer\\java``` points to you existing Java installation directory\n\n\nFor Linux/Mac:\n\n```export JAVA_HOME=/opt/WebSphere/AppServer/java```\n\nwhere ```/opt/WebSphere/AppServer/java``` points to you existing Java installation directory\n\nRun the utility using the following command:\n\n```WASPre/bin/WASPreUpgrade.sh /home/icpadmin/Documents/backup /opt/IBM/WebSphere/AppServer855/profiles/AppSrv01```\n\n4e. Zip backup folder using the command:\n\n```zip -r backup.zip backup```\n\n4f. Transfer archive to machine with WCMT4IC and unzip it. In the tool click **Browse** button, locate unzipped folder, select it and click **Open**\n\n![Remote Cell import](images/tWAS-build/04c-remote-utility-import.jpg)\n\n4g. Ensure that correct directory is visible and click **Choose Directory**\n\n![Remote Cell choose](images/tWAS-build/04d-remote-utility-choose.jpg)\n\n4h. Your WebSphere cell and profile data are prefilled, select required profile and click **Next**\n\n![Remote Cell select](images/tWAS-build/03-select-cell.jpg)\n\n5. Select application to be migrated and click **Next**\n\n![Select application](images/tWAS-build/05-select-app.jpg)\n\n\n6. Generate container artifacts. The first step is to create the migration backup directory for the node containing the selected application to be migrated. Click **Migrate**.\n\n![Migrate](images/tWAS-build/06-migr-backup.jpg)\n\n7. If WebSphere global security is enabled you will be prompted for the userid and password.\n\n![Authenticate](images/tWAS-build/07-migr-backup-pass.jpg)\n\n8. Second step is to generate the required files to create container image. You may change target directory or accept the default provided. Click **Generate**\n\n![Generate](images/tWAS-build/08-generate.jpg)\n\n9. Third step is to examine generated files. You will do it later. Click **Next**\n\n![Review](images/tWAS-build/09-review.jpg)\n\n10. Artifacts are successfully generated, now you need to review and customize them according to your needs. Generated artifacts include:\n- Dockerfile\n- Migration directory\n- migration.properties\n\n![Complete modify](images/tWAS-build/10-modify.jpg).\n\n## Modify artifacts\n\n\nHere is [generated Dockerfile](artifacts/tWAS-build-WCMT/Dockerfile_generated). This is not enough in our case. The migrated application required database drivers, which was defined via WebSphere variable and located in the external directory.\n\n![Driver path](images/tWAS-build/11-driver-path.jpg)\n\nYou have to copy the drivers to the generated directory where Dockerfile is located and modify Dockerfile with information where to put them in the image. Add highlighted line to Dockerfile.\n\n```COPY --from=migration --chown=was:0 /opt/IBM/WebSphere/AppServer/java/8.0/jre/lib/security/java.security /opt/IBM/WebSphere/AppServer/java/8.0/jre/lib/security/```\n**```COPY --chown=was:0 db2drivers/ /opt/IBM/db2drivers/```**\n```ENV ADMIN_USER_NAME=wasadmin```\n\nHere you can find final version of the [Dockerfile](artifacts/tWAS-build/Dockerfile).\n\nWhat if you would like to modify some settings in the migrated WebSphere?\nYou can customize your image using property-based configuration mechanism. All available objects are described [Managing specific configuration objects using properties files](https://www.ibm.com/support/knowledgecenter/en/SS7JFU_8.5.5/com.ibm.websphere.express.doc/ae/txml_config_prop.html).\nLet's say you would like to change value of this ```DB2UNIVERSAL_JDBC_DRIVER_PATH``` variable.\n\nYou can create the db2env.props file, with the following contents:\n\n```\nResourceType=VariableMap\nImplementingResourceType=VariableMap\nResourceId=Cell=!{cellName}:Node=!{nodeName}:Server=!{serverName}:VariableMap=\nAttributeInfo=entries(symbolicName,value)\nDB2UNIVERSAL_JDBC_DRIVER_PATH=/mydrivers/db2\n```\n\nand add these to the Dockerfile in the following way:\n\n```\nCOPY --chown=was:0 db2env.props /work/config/db2env.props\nRUN /work/configure.sh\n```\n\nThis works for changes to the configuration you want to make at **build** time.  There are other options for configuration changes you would want to make at **deploy** time.  Jump to this section [here](tWAS-build.md#modifying-configuration-without-rebuilding-container)\n\n\n## Build the image\n\nSee section in [tWAS-build.md](tWAS-build.md#Build-the-image)\n\n## Test the image\n\nSee section in [tWAS-build.md](tWAS-build.md#test-the-image)\n\n\n## Modifying Configuration without rebuilding container\n\nSee section in [tWAS-build.md](tWAS-build.md#Modifying-configuration-without-rebuilding-container)\n\n## Conclusion\n\nIn conclusion, we've taken our estisting traditional WebSphere application.  We've loaded the container with the server and application configuration.  We've installed the application, and modified the configuration if required.  This sets us up for integrating all of this into a CI/CD pipeline and then deploying this to Kubernetes. \n\nWe're on our way to the cloud!\n","type":"Mdx","contentDigest":"e9dedfd04ccd9e85b372e603d309e373","counter":326,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":""},"exports":{},"rawBody":"# Building a tWAS container from an existing environment (without scripts)\n\nThis section covers how to containerize an existing application running on traditional WebSphere Application Server.  Ideally a user would have scripts to configure their environment and building a container using scripts is descibed [here](tWAS-build.md). However if you don't have scripts and building those scripts is a daunting task, you can migrate your existing configuration using the [WebSphere Configuration Migration Tool for IBM Cloud (WCMT4IC)](https://developer.ibm.com/wasdev/docs/websphere-config-migration-cloud/).  This tool extracts the configuration from your existing traditional WebSphere Application Server environment and puts it into a tWAS container. \n\n\n## Summary: \nThis section has the following steps:\n\n- Run [WebSphere Configuration Migration Tool for IBM Cloud (WCMT4IC)] to extract the server configuration information from an existing environment.\n- [Using environment variables in properties files to allow configuration to be injected in to the runtime environment dynamically.](tWAS-build.md#modifying-configuration-without-rebuilding-container)\n- Running the application in a Docker container locally\n\n\n## Introduction to the WebSphere Configuration Migration Tool for IBM Cloud\nWCMT4IC is a Java based tool, that provides an easy to use wizard for cloning your WebSphere V7, V8, V855 or V9 environment to the IBM Cloud or to your IBM Cloud Private installation. It allows you to selectively migrate an application deployed in your WebSphere cell into its own WebSphere standalone server, which can run on a virtual machine or in a Docker container ready to be deployed in IBM Cloud Private (ICP).\n\nThis article focuses on the steps required to migrate to a Docker container.\n\n## Install WebSphere Configuration Migration Tool for IBM Cloud\nWCMT4IC is freely available to download from [here](https://developer.ibm.com/wasdev/downloads/#asset/tools-WebSphere_Configuration_Migration_Tool_for_IBM_Cloud). To install the tool extract downloaded file to new directory. As the tool requires Java 8 or higher, make sure Java is available in your PATH environment variable. If not, you can set it like this:\n\nFor Windows:\n\n```set PATH=C:\\java\\bin;%PATH%```\n\nwhere ```C:\\java``` points to you existing Java installation directory\n\n\nFor Linux/Mac:\n\n```export PATH=/opt/java8/bin:$PATH```\n\nwhere ```/opt/java8/``` points to you existing Java installation directory\n\nTo start the tool run this command for the installation folder:\n\n```java -jar CloudMigration.jar```\n\nThe tool can either be installed and run on the machine where WebSphere Application Server is installed or on a remote location. \n\n## Using the tool to generate artifacts\nAfter you start the tool, it opens the following window where you can choose either Virtual Machine wizard or Container (Docker) wizard. In this guide you will use the container one.\n\n1. Click **Start Containers Migration Wizard**\n\n![Wizard](images/tWAS-build/01-wizard.jpg)\n\n2. The welcome screen is shown, which describes overview of the steps. Click **Next >**\n\n![Welcome](images/tWAS-build/02-welcome.jpg)\n\n3. WebSphere cell selection screen is shown. If you are running the tool on the same machine where WebSphere is installed, then the installation folder and list of available cells(profiles) are automatically populated. Select cell and click **Next >**. Alternatively, if installation folder is not populated or WebSphere is not installed locally, click **Locate ...** button to work with remote installation. **If you are running locally, go directly to step 5**.\n\n![Select Cell](images/tWAS-build/03-select-cell.jpg)\n\n4a. (Optional - Remote installation only) Select **Install from an installation on another server** and then click **Save WASPreUpgrade utility**.\n\n![Remote Cell](images/tWAS-build/04-remote-cell.jpg)\n\n4b. Select directory, specify filename for WASPreUpgrade utility archive and click **Save**\n\n![Remote Cell utility](images/tWAS-build/04a-remote-utility.jpg)\n\n4c. Utility is being saved\n\n![Remote Cell progress](images/tWAS-build/04b-remote-utility-progress.jpg)\n\n4d. Transfer the generated utility archive to the target server and unzip it. Utility requires ```JAVA_HOME``` environment variable. You can set it like this.\nFor Windows:\n\n```set JAVA_HOME=C:\\WebSphere\\AppServer\\java```\n\nwhere ```C:\\WebSphere\\AppServer\\java``` points to you existing Java installation directory\n\n\nFor Linux/Mac:\n\n```export JAVA_HOME=/opt/WebSphere/AppServer/java```\n\nwhere ```/opt/WebSphere/AppServer/java``` points to you existing Java installation directory\n\nRun the utility using the following command:\n\n```WASPre/bin/WASPreUpgrade.sh /home/icpadmin/Documents/backup /opt/IBM/WebSphere/AppServer855/profiles/AppSrv01```\n\n4e. Zip backup folder using the command:\n\n```zip -r backup.zip backup```\n\n4f. Transfer archive to machine with WCMT4IC and unzip it. In the tool click **Browse** button, locate unzipped folder, select it and click **Open**\n\n![Remote Cell import](images/tWAS-build/04c-remote-utility-import.jpg)\n\n4g. Ensure that correct directory is visible and click **Choose Directory**\n\n![Remote Cell choose](images/tWAS-build/04d-remote-utility-choose.jpg)\n\n4h. Your WebSphere cell and profile data are prefilled, select required profile and click **Next**\n\n![Remote Cell select](images/tWAS-build/03-select-cell.jpg)\n\n5. Select application to be migrated and click **Next**\n\n![Select application](images/tWAS-build/05-select-app.jpg)\n\n\n6. Generate container artifacts. The first step is to create the migration backup directory for the node containing the selected application to be migrated. Click **Migrate**.\n\n![Migrate](images/tWAS-build/06-migr-backup.jpg)\n\n7. If WebSphere global security is enabled you will be prompted for the userid and password.\n\n![Authenticate](images/tWAS-build/07-migr-backup-pass.jpg)\n\n8. Second step is to generate the required files to create container image. You may change target directory or accept the default provided. Click **Generate**\n\n![Generate](images/tWAS-build/08-generate.jpg)\n\n9. Third step is to examine generated files. You will do it later. Click **Next**\n\n![Review](images/tWAS-build/09-review.jpg)\n\n10. Artifacts are successfully generated, now you need to review and customize them according to your needs. Generated artifacts include:\n- Dockerfile\n- Migration directory\n- migration.properties\n\n![Complete modify](images/tWAS-build/10-modify.jpg).\n\n## Modify artifacts\n\n\nHere is [generated Dockerfile](artifacts/tWAS-build-WCMT/Dockerfile_generated). This is not enough in our case. The migrated application required database drivers, which was defined via WebSphere variable and located in the external directory.\n\n![Driver path](images/tWAS-build/11-driver-path.jpg)\n\nYou have to copy the drivers to the generated directory where Dockerfile is located and modify Dockerfile with information where to put them in the image. Add highlighted line to Dockerfile.\n\n```COPY --from=migration --chown=was:0 /opt/IBM/WebSphere/AppServer/java/8.0/jre/lib/security/java.security /opt/IBM/WebSphere/AppServer/java/8.0/jre/lib/security/```\n**```COPY --chown=was:0 db2drivers/ /opt/IBM/db2drivers/```**\n```ENV ADMIN_USER_NAME=wasadmin```\n\nHere you can find final version of the [Dockerfile](artifacts/tWAS-build/Dockerfile).\n\nWhat if you would like to modify some settings in the migrated WebSphere?\nYou can customize your image using property-based configuration mechanism. All available objects are described [Managing specific configuration objects using properties files](https://www.ibm.com/support/knowledgecenter/en/SS7JFU_8.5.5/com.ibm.websphere.express.doc/ae/txml_config_prop.html).\nLet's say you would like to change value of this ```DB2UNIVERSAL_JDBC_DRIVER_PATH``` variable.\n\nYou can create the db2env.props file, with the following contents:\n\n```\nResourceType=VariableMap\nImplementingResourceType=VariableMap\nResourceId=Cell=!{cellName}:Node=!{nodeName}:Server=!{serverName}:VariableMap=\nAttributeInfo=entries(symbolicName,value)\nDB2UNIVERSAL_JDBC_DRIVER_PATH=/mydrivers/db2\n```\n\nand add these to the Dockerfile in the following way:\n\n```\nCOPY --chown=was:0 db2env.props /work/config/db2env.props\nRUN /work/configure.sh\n```\n\nThis works for changes to the configuration you want to make at **build** time.  There are other options for configuration changes you would want to make at **deploy** time.  Jump to this section [here](tWAS-build.md#modifying-configuration-without-rebuilding-container)\n\n\n## Build the image\n\nSee section in [tWAS-build.md](tWAS-build.md#Build-the-image)\n\n## Test the image\n\nSee section in [tWAS-build.md](tWAS-build.md#test-the-image)\n\n\n## Modifying Configuration without rebuilding container\n\nSee section in [tWAS-build.md](tWAS-build.md#Modifying-configuration-without-rebuilding-container)\n\n## Conclusion\n\nIn conclusion, we've taken our estisting traditional WebSphere application.  We've loaded the container with the server and application configuration.  We've installed the application, and modified the configuration if required.  This sets us up for integrating all of this into a CI/CD pipeline and then deploying this to Kubernetes. \n\nWe're on our way to the cloud!\n","fileAbsolutePath":"/home/runner/work/modernization-playbook/modernization-playbook/src/pages/applications/was90/tWAS-build-WCMT4IC.mdx"}}}}