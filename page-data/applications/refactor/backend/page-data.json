{"componentChunkName":"component---src-pages-applications-refactor-backend-mdx","path":"/applications/refactor/backend/","result":{"pageContext":{"frontmatter":{"title":"Refactoring Java EE Applications","description":"A example of refactoring a Java EE Application to Micro Services"},"relativePagePath":"/applications/refactor/backend.mdx","titleType":"append","MdxNode":{"id":"c3fd4cd4-9c4f-5357-a080-69f800582510","children":[],"parent":"233cd08c-94b6-58bb-ba57-164294d43e76","internal":{"content":"---\ntitle: Refactoring Java EE Applications\ndescription: A example of refactoring a Java EE Application to Micro Services\n---\n\nexport const Title = () => (\n  <span>\nRefactoring Java EE Applications<br/> <h2>A phased approach to refactoring a Monolith in to Micro Services</h2>\n  </span>\n);\n\n<PageDescription>\n\nModernizing the backend JEE code\n\n</PageDescription>\n\n<AnchorLinks small>\n  <AnchorLink>Introduction</AnchorLink>\n  <AnchorLink>Move the backend monolith to OpenLiberty</AnchorLink>\n  <AnchorLink>Update server.xml</AnchorLink>\n  <AnchorLink>Update the pom files</AnchorLink>\n  <AnchorLink>Run this solution</AnchorLink>\n  <AnchorLink>Summary</AnchorLink>\n</AnchorLinks>\n\n\n## Introduction\nIn this phase the JEE6 EJB code is modernized to use MicroProfile and is then able to run on the latest open source version of Liberty (OpenLiberty)\n\n## Move the backend monolith to OpenLiberty\n\n  ![Step 5](images/step5.png)\n\n### Restructure the repository\nIn order to use the capabilities provided by the OpenLiberty [development mode](https://openliberty.io/blog/2019/10/22/liberty-dev-mode.html) and to make the modernization easier, the structure of the GitHub repository was changed from multiple modules to a single module.\n\nOpenLiberty [development mode](https://openliberty.io/blog/2019/10/22/liberty-dev-mode.html) provides the developer with a framework for:\n\n  - Hot code replacements\n  - Debugging incl. debugging in containers\n  - IDE support like errors, warnings, auto-complete, and much more\n\nThe changes to the repository had the following steps:\n\n- Create a new Open Liberty project and copy the source code from all sub-projects in it\n- Merge all pom.xml files\n- Take over the configuration files (server.xml, persistence.xml, etc.)\n- Update the paths in the Dockerfile\n\nThe project structure on the left hand side shows the original multi-modules structure, the right side the simplified new structure.\n\n![Eclipse](images/open-liberty-project-structure.png)\n\nIf you wish to review the repositories structure and pom files, here are the links to the [before repostory](https://github.com/IBM/application-modernization-javaee-quarkus/tree/master/monolith-open-liberty) and [after repository](https://github.com/IBM/application-modernization-javaee-quarkus/tree/master/monolith-open-liberty-cloud-native)\n\n### Replace EJBs with CDI\nTo simplify the code, EJBs (Enterprise Java Beans) have been replaced with CDI (Contexts and Dependency Injection) since all code runs in the same context now. For example this was the original EJB code:\n\n```\n@Stateless\npublic class ProductSearchServiceImpl implements ProductSearchService {\n   ...\n}\n\npublic class CategoryResource {\n   @EJB ProductSearchService productSearch;\n   ...\n   productSearch = (ProductSearchService) new InitialContext().lookup(\"java:app/CustomerOrderServices/ProductSearchServiceImpl!org.pwte.example.service.ProductSearchService\");\n   ...\n}\n```\n\nThis is the converted code using CDI:\n\n```\n@ApplicationScoped\npublic class ProductSearchServiceImpl implements ProductSearchService {\n   ...\n}\n\n@ApplicationScoped\npublic class CategoryResource {\n   @Inject\n   ProductSearchServiceImpl productSearch;\n   ...\n}\n```\n\nIn order to handle transactions, you can use @Transactional which is part of the Java/Jakarta EE standard Java Transaction API (JTA). In the easiest case you simply use the annotation on your method.\n\n```\n@Transactional\npublic void updateLineItem(String productId, String newPrice) {\n   ...\n}\n```\n\nIf you need more control, you can also manage the transactions manually:\n\n```\n@PersistenceContext\nprotected EntityManager em;\n\n@Resource\nUserTransaction utx;\n\n@Transactional\npublic void updateLineItem(String productId, String newPrice) {\n   utx.begin();\n   em.persist(lineItem);\n   utx.commit();\n   ...\n}\n```\n\n### Update server.xml\nIn order to `server.xml` file was updated to change the features loaded by Liberty on startup. The older JEE6 features were removed and replaced by jakartaee-8.0` and `microprofile-3.3`. The final [server.xml](https://github.com/IBM/application-modernization-javaee-quarkus/blob/master/monolith-open-liberty/liberty/server.xml) file can be found in the project repository.\n\n```\n  <featureManager>\n      <feature>microProfile-3.3</feature>\n      <feature>jakartaee-8.0</feature>\n      <feature>mpReactiveStreams-1.0</feature>\n      <feature>mpReactiveMessaging-1.0</feature>\n      <feature>monitor-1.0</feature>\n  </featureManager>\n```\n\n### Update the pom files\nAfter combining the `pom.xml` files in the previous step, it is necessary to now add some dependencies for `jakartaee-8.0` and `microprofile-3.3` as shown below. The final [pom.xml](https://github.com/IBM/application-modernization-javaee-quarkus/blob/master/monolith-open-liberty-cloud-native/pom.xml) file is in the project repository\n\n```\n<dependency>\n   <groupId>jakarta.platform</groupId>\n   <artifactId>jakarta.jakartaee-api</artifactId>\n   <version>8.0.0</version>\n   <scope>provided</scope>\n</dependency>\n<dependency>\n   <groupId>org.eclipse.microprofile</groupId>\n   <artifactId>microprofile</artifactId>\n   <version>3.3</version>\n   <type>pom</type>\n   <scope>provided</scope>\n</dependency>\n```\n\n### Update the Dockerfile\n`OpenLiberty` uses the [openliberty/open-liberty](https://hub.docker.com/r/openliberty/open-liberty) Docker images and has some minor differences from WebSphere Liberty regarding how features are loaded (OpenLiberty has it's own `features.sh` command in addition to `configure.sh`). The final [Dockerfile](https://github.com/IBM/application-modernization-javaee-quarkus/blob/master/monolith-open-liberty-cloud-native/Dockerfile.multistage) can be found in the project repository\n\n```\nFROM adoptopenjdk/maven-openjdk11 as BUILD\nCOPY . /usr/src/app/src\nWORKDIR /usr/src/app/src/CustomerOrderServicesProject\nRUN mvn clean package\n\nFROM open-liberty:kernel-slim-java11-openj9\nUSER root\nCOPY --chown=1001:0 ./liberty/server.xml /config\nCOPY --chown=1001:0 ./liberty/server.env /config\nCOPY --chown=1001:0 ./liberty/jvm.options /config\n\nARG SSL=false\nARG HTTP_ENDPOINT=false\n\nRUN features.sh\n\nCOPY --from=build --chown=1001:0 /usr/src/app/src/CustomerOrderServicesApp/target/CustomerOrderServicesApp-0.1.0-SNAPSHOT.ear /config/apps/CustomerOrderServicesApp-0.1.0-SNAPSHOT.ear\nCOPY --from=build --chown=1001:0 /usr/src/app/src/resources/ /opt/ol/wlp/usr/shared/resources/\nRUN chown -R 1001.0 /config /opt/ol/wlp/usr/servers/defaultServer /opt/ol/wlp/usr/shared/resources && chmod -R g+rw /config /opt/ol/wlp/usr/servers/defaultServer  /opt/ol/wlp/usr/shared/resources\n\nUSER 1001\nRUN configure.sh\n```\n\n### Run this solution\nUse the following steps to run this solution locally on Docker\n\n```\n$ git clone https://github.com/IBM/application-modernization-javaee-quarkus.git && cd application-modernization-javaee-quarkus\n$ ROOT_FOLDER=$(pwd)\n$ sh ${ROOT_FOLDER}/scripts-docker/build-and-run-monolith-db2.sh\n$ sh ${ROOT_FOLDER}/scripts-docker/build-and-run-splitted-frontend-open.sh\n```\n\n## Summary\nThis application has been refactored in a series of steps from the original [WebSphere ND v8.5.5 version](https://github.com/ibm-cloud-architecture/cloudpak-for-applications/tree/was855) to run as Micro Services on Red Hat OpenShift.\n","type":"Mdx","contentDigest":"d24f46d96508ef79453161b37adf3282","counter":464,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"Refactoring Java EE Applications","description":"A example of refactoring a Java EE Application to Micro Services"},"exports":{},"rawBody":"---\ntitle: Refactoring Java EE Applications\ndescription: A example of refactoring a Java EE Application to Micro Services\n---\n\nexport const Title = () => (\n  <span>\nRefactoring Java EE Applications<br/> <h2>A phased approach to refactoring a Monolith in to Micro Services</h2>\n  </span>\n);\n\n<PageDescription>\n\nModernizing the backend JEE code\n\n</PageDescription>\n\n<AnchorLinks small>\n  <AnchorLink>Introduction</AnchorLink>\n  <AnchorLink>Move the backend monolith to OpenLiberty</AnchorLink>\n  <AnchorLink>Update server.xml</AnchorLink>\n  <AnchorLink>Update the pom files</AnchorLink>\n  <AnchorLink>Run this solution</AnchorLink>\n  <AnchorLink>Summary</AnchorLink>\n</AnchorLinks>\n\n\n## Introduction\nIn this phase the JEE6 EJB code is modernized to use MicroProfile and is then able to run on the latest open source version of Liberty (OpenLiberty)\n\n## Move the backend monolith to OpenLiberty\n\n  ![Step 5](images/step5.png)\n\n### Restructure the repository\nIn order to use the capabilities provided by the OpenLiberty [development mode](https://openliberty.io/blog/2019/10/22/liberty-dev-mode.html) and to make the modernization easier, the structure of the GitHub repository was changed from multiple modules to a single module.\n\nOpenLiberty [development mode](https://openliberty.io/blog/2019/10/22/liberty-dev-mode.html) provides the developer with a framework for:\n\n  - Hot code replacements\n  - Debugging incl. debugging in containers\n  - IDE support like errors, warnings, auto-complete, and much more\n\nThe changes to the repository had the following steps:\n\n- Create a new Open Liberty project and copy the source code from all sub-projects in it\n- Merge all pom.xml files\n- Take over the configuration files (server.xml, persistence.xml, etc.)\n- Update the paths in the Dockerfile\n\nThe project structure on the left hand side shows the original multi-modules structure, the right side the simplified new structure.\n\n![Eclipse](images/open-liberty-project-structure.png)\n\nIf you wish to review the repositories structure and pom files, here are the links to the [before repostory](https://github.com/IBM/application-modernization-javaee-quarkus/tree/master/monolith-open-liberty) and [after repository](https://github.com/IBM/application-modernization-javaee-quarkus/tree/master/monolith-open-liberty-cloud-native)\n\n### Replace EJBs with CDI\nTo simplify the code, EJBs (Enterprise Java Beans) have been replaced with CDI (Contexts and Dependency Injection) since all code runs in the same context now. For example this was the original EJB code:\n\n```\n@Stateless\npublic class ProductSearchServiceImpl implements ProductSearchService {\n   ...\n}\n\npublic class CategoryResource {\n   @EJB ProductSearchService productSearch;\n   ...\n   productSearch = (ProductSearchService) new InitialContext().lookup(\"java:app/CustomerOrderServices/ProductSearchServiceImpl!org.pwte.example.service.ProductSearchService\");\n   ...\n}\n```\n\nThis is the converted code using CDI:\n\n```\n@ApplicationScoped\npublic class ProductSearchServiceImpl implements ProductSearchService {\n   ...\n}\n\n@ApplicationScoped\npublic class CategoryResource {\n   @Inject\n   ProductSearchServiceImpl productSearch;\n   ...\n}\n```\n\nIn order to handle transactions, you can use @Transactional which is part of the Java/Jakarta EE standard Java Transaction API (JTA). In the easiest case you simply use the annotation on your method.\n\n```\n@Transactional\npublic void updateLineItem(String productId, String newPrice) {\n   ...\n}\n```\n\nIf you need more control, you can also manage the transactions manually:\n\n```\n@PersistenceContext\nprotected EntityManager em;\n\n@Resource\nUserTransaction utx;\n\n@Transactional\npublic void updateLineItem(String productId, String newPrice) {\n   utx.begin();\n   em.persist(lineItem);\n   utx.commit();\n   ...\n}\n```\n\n### Update server.xml\nIn order to `server.xml` file was updated to change the features loaded by Liberty on startup. The older JEE6 features were removed and replaced by jakartaee-8.0` and `microprofile-3.3`. The final [server.xml](https://github.com/IBM/application-modernization-javaee-quarkus/blob/master/monolith-open-liberty/liberty/server.xml) file can be found in the project repository.\n\n```\n  <featureManager>\n      <feature>microProfile-3.3</feature>\n      <feature>jakartaee-8.0</feature>\n      <feature>mpReactiveStreams-1.0</feature>\n      <feature>mpReactiveMessaging-1.0</feature>\n      <feature>monitor-1.0</feature>\n  </featureManager>\n```\n\n### Update the pom files\nAfter combining the `pom.xml` files in the previous step, it is necessary to now add some dependencies for `jakartaee-8.0` and `microprofile-3.3` as shown below. The final [pom.xml](https://github.com/IBM/application-modernization-javaee-quarkus/blob/master/monolith-open-liberty-cloud-native/pom.xml) file is in the project repository\n\n```\n<dependency>\n   <groupId>jakarta.platform</groupId>\n   <artifactId>jakarta.jakartaee-api</artifactId>\n   <version>8.0.0</version>\n   <scope>provided</scope>\n</dependency>\n<dependency>\n   <groupId>org.eclipse.microprofile</groupId>\n   <artifactId>microprofile</artifactId>\n   <version>3.3</version>\n   <type>pom</type>\n   <scope>provided</scope>\n</dependency>\n```\n\n### Update the Dockerfile\n`OpenLiberty` uses the [openliberty/open-liberty](https://hub.docker.com/r/openliberty/open-liberty) Docker images and has some minor differences from WebSphere Liberty regarding how features are loaded (OpenLiberty has it's own `features.sh` command in addition to `configure.sh`). The final [Dockerfile](https://github.com/IBM/application-modernization-javaee-quarkus/blob/master/monolith-open-liberty-cloud-native/Dockerfile.multistage) can be found in the project repository\n\n```\nFROM adoptopenjdk/maven-openjdk11 as BUILD\nCOPY . /usr/src/app/src\nWORKDIR /usr/src/app/src/CustomerOrderServicesProject\nRUN mvn clean package\n\nFROM open-liberty:kernel-slim-java11-openj9\nUSER root\nCOPY --chown=1001:0 ./liberty/server.xml /config\nCOPY --chown=1001:0 ./liberty/server.env /config\nCOPY --chown=1001:0 ./liberty/jvm.options /config\n\nARG SSL=false\nARG HTTP_ENDPOINT=false\n\nRUN features.sh\n\nCOPY --from=build --chown=1001:0 /usr/src/app/src/CustomerOrderServicesApp/target/CustomerOrderServicesApp-0.1.0-SNAPSHOT.ear /config/apps/CustomerOrderServicesApp-0.1.0-SNAPSHOT.ear\nCOPY --from=build --chown=1001:0 /usr/src/app/src/resources/ /opt/ol/wlp/usr/shared/resources/\nRUN chown -R 1001.0 /config /opt/ol/wlp/usr/servers/defaultServer /opt/ol/wlp/usr/shared/resources && chmod -R g+rw /config /opt/ol/wlp/usr/servers/defaultServer  /opt/ol/wlp/usr/shared/resources\n\nUSER 1001\nRUN configure.sh\n```\n\n### Run this solution\nUse the following steps to run this solution locally on Docker\n\n```\n$ git clone https://github.com/IBM/application-modernization-javaee-quarkus.git && cd application-modernization-javaee-quarkus\n$ ROOT_FOLDER=$(pwd)\n$ sh ${ROOT_FOLDER}/scripts-docker/build-and-run-monolith-db2.sh\n$ sh ${ROOT_FOLDER}/scripts-docker/build-and-run-splitted-frontend-open.sh\n```\n\n## Summary\nThis application has been refactored in a series of steps from the original [WebSphere ND v8.5.5 version](https://github.com/ibm-cloud-architecture/cloudpak-for-applications/tree/was855) to run as Micro Services on Red Hat OpenShift.\n","fileAbsolutePath":"/home/runner/work/modernization-playbook/modernization-playbook/src/pages/applications/refactor/backend.mdx"}}},"staticQueryHashes":["1054721580","1054721580","1364590287","2102389209","2102389209","2456312558","2746626797","3018647132","3037994772","768070550"]}